{% import "macros/getSubjectTemplate.html" as subject_macros %}
{% extends "base.html" %}

{% block main_content %}
<link rel="stylesheet" href="/css/index.css">
<link defer rel="stylesheet" href="/css/alerts.css">
<script defer src="/js/openLinkHandler.js"></script>
<script>
(function() {
    const isMobileOrTablet = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                             || window.innerWidth <= 768;
    
    if (isMobileOrTablet) {
        // Dynamically load mobile-nav.js only for mobile/tablet
        const script = document.createElement('script');
        script.src = '/js/mobile-nav.js';
        script.async = true;
        document.head.appendChild(script);
    }
})();
</script>
<main>
    {% include 'components/login.html' %}
    <article>
        <section class="body" style="display: none;">
            <br>
            <div class="alerts">
                <div class="alert alert-info">
                    <div class="alert-type">
                        <strong>Disclaimer</strong>
                    </div>
                    <div class="alert-content">
                        This site is in no way affiliated to PESU Academy or pes.edu.
                        All content is borrowed from PESU Academy unless explicitly stated.
                    </div>
                </div>
            </div><br>
            {{ post_macros::page_header(title=page.title) }}
            {{ page.content | safe }}
            <div class="parent-parent">
            <ul class="parent" style="list-style-type: none;">
                <li>
                    {{ subject_macros::subject_include(subject_template=page.extra.subject_template) }}
                </li>
            </ul>
            </div>
        </section>
    </article>
</main>
<script>
    // Open first 2 levels of <details> tags on page load and handle toggle behavior
    document.addEventListener('DOMContentLoaded', function () {
        if (!sessionStorage.getItem('user_session')) { localStorage.setItem('postLoginRedirect', window.location.href); }
        // Function to get nesting level of a details element
        function getDetailsLevel(element) {
            let level = 0;
            let parent = element.parentElement;
            while (parent) {
                if (parent.tagName === 'DETAILS') {
                    level++;
                }
                parent = parent.parentElement;
            }
            return level;
        }

        // Open first 2 levels
        document.querySelectorAll('details').forEach(function (details) {
            const level = getDetailsLevel(details);
            if (level < 2) {
                details.open = true;
            }
        });

        // Close all child <details> when a parent <details> is closed
        document.querySelectorAll('details').forEach(function (details) {
            details.addEventListener('toggle', function () {
                if (!details.open) {
                    details.querySelectorAll('details').forEach(function (child) {
                        child.open = false;
                    });
                }
            });
        });
    });
</script>
{% endblock main_content %}
{% extends "base.html" %}
{% macro home_page(section) %}
<link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="/css/alerts.css">
<link rel="stylesheet" href="/css/loading_animation.css">
<link rel="stylesheet" href="/css/login_form.css">
<script src="/js/login.js"></script>
<script>
    !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init Ce js Ls Te Fs Ds capture Ye calculateEventProperties Us register register_once register_for_session unregister unregister_for_session Ws getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSurveysLoaded onSessionId getSurveys getActiveMatchingSurveys renderSurvey displaySurvey canRenderSurvey canRenderSurveyAsync identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty Bs zs createPersonProfile Hs Ms Gs opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing get_explicit_consent_status is_capturing clear_opt_in_out_capturing Ns debug L qs getPageViewId captureTraceFeedback captureTraceMetric".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
    posthog.init('phc_78cRhH8qoYmTyUHbMXdUxqrFPFfrdVp3yxzK0gdqB6Q', {
        api_host: 'https://us.i.posthog.com',
        defaults: '2025-05-24',
        person_profiles: 'identified_only',
    })
</script>
<main>
    <div id="login-modal" class="login-modal">
        <div class="login-modal-content">
            <div class="login-modal-header">
                <h2>üéì Student Login</h2>
            </div>
            <div class="login-modal-body">
                <form id="login-form">
                    <div class="error-message" id="error-message"></div>
                    
                    <div class="form-group">
                        <label for="srn-input">SRN/PRN:</label>
                        <input type="text" id="srn-input" placeholder="Enter your SRN or PRN" autocomplete="username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password-input">Password:</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="password-input" placeholder="Enter your password" autocomplete="current-password" required>
                            <button type="button" class="password-toggle" id="password-toggle" title="Show/Hide Password">
                                üëÅÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div class="login-buttons">
                        <button type="submit" class="btn btn-primary">Login</button>
                        <button type="button" class="btn btn-secondary" id="cancel-login">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">Verifying details<span class="loading-dots"></span></div>
        </div>
    </div>
    
    <!-- Main content -->
    <article>
        <section class="body" style="display: none;">
            <br>
            <div class="alerts">
                <div class="alert alert-info">
                    <div class="alert-type">
                        <strong>Disclaimer</strong>
                    </div>
                    <div class="alert-content">
                        This site is in no way affiliated to PESU Academy or pes.edu.
                        All content is borrowed from PESU Academy unless explicitly stated.
                    </div>
                </div>
            </div><br>
            <div class="alerts">
                <div class="alert alert-error">
                    <div class="alert-type">
                        <strong>Upcoming: ISA-1</strong>
                    </div>
                    <div class="alert-content">
                        <a href="/pdf-viewer/?file=/time_tables/BCA_1st_3rd__5th_sem_ISA-1_TT.pdf" target="_blank" rel="noopener noreferrer">Time Table for ISA-1</a>
                    </div>
                </div>
            </div>
            {{ post_macros::page_header(title=section.title) }}
            {{ section.content | safe }}
            <div class="parent-parent">
            <ul class="parent" style="list-style-type: none;">
                <li>
                    {% include 'web_design.html' %}
                </li>
                <li>
                    {% include 'cfp.html' %}
                </li>
                <li>
                    {% include 'mp.html' %}
                </li>
                <li>
                    {% include 'mfca.html' %}
                </li>
                <li>
                    {% include 'pce.html' %}
                </li>
            </ul>
            </div>
        </section>
    </article>
</main>
<script>
document.addEventListener('click', function(event) {
    const link = event.target.closest('a');
    if (link && link.href && link.href.includes('/pdf-viewer/')) {
        event.preventDefault();
        
        // Check session
        const sessionData = sessionStorage.getItem('user_session');
        if (!sessionData) {
            window.location.href = '/';
            return;
        }

        try {
            const session = JSON.parse(sessionData);
            const now = new Date();
            const expiresAt = new Date(session.expiresAt);
            
            if (now >= expiresAt) {
                window.location.href = '/';
                return;
            }

            // Add session data to URL for new tab
            const url = new URL(link.href);
            url.searchParams.set('token', session.token);
            url.searchParams.set('expires', expiresAt.getTime());
            url.searchParams.set('title', link.innerText);
            
            window.open(url.href, '_blank');
        } catch (error) {
            window.location.href = '/';
        }
    }
});
</script>
<script>
    // Close all child <details> when a parent <details> is closed
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('details').forEach(function (details) {
            details.addEventListener('toggle', function () {
                if (!details.open) {
                    details.querySelectorAll('details').forEach(function (child) {
                        child.open = false;
                    });
                }
            });
        });
    });
</script>
{% endmacro home_page %}

{% block main_content %}
{{ self::home_page(section=section) }}
{% endblock main_content %}